<!-- In file: Frontend/src/app/componet/file-preview/enhanced-video-preview.component.html -->

<div class="enhanced-video-preview">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-content">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="loading-text">Initializing video preview...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-content">
      <mat-icon class="error-icon">error</mat-icon>
      <h3>Preview Error</h3>
      <p>{{ errorMessage }}</p>
             <div class="error-actions">
         <button mat-raised-button color="primary" (click)="retry()">
           <mat-icon>refresh</mat-icon>
           Retry
         </button>

         <button mat-raised-button color="accent" (click)="downloadFile()">
           <mat-icon>download</mat-icon>
           Download File
         </button>
       </div>
    </div>
  </div>

  <!-- Video Preview Content -->
  <div *ngIf="!loading && !error" class="video-content">
    <!-- File Information Header -->
    <div class="file-info-header">
      <div class="file-details">
        <h3>{{ previewMetadata?.filename }}</h3>
        <p class="file-meta">
          <span class="file-size">{{ getFormattedFileSize() }}</span>
          <span class="file-type">{{ previewMetadata?.content_type }}</span>
          <span class="connection-speed">{{ getConnectionSpeedText() }}</span>
        </p>
      </div>
      
             <!-- Cache Statistics -->
       <div *ngIf="cacheStats" class="cache-stats">
         <div class="cache-stat-item">
           <span class="cache-label">Cache Hit Rate:</span>
           <span class="cache-value">{{ cacheStats.hit_rate_percent }}%</span>
         </div>
         <div class="cache-stat-item">
           <span class="cache-label">Cached Items:</span>
           <span class="cache-value">{{ cacheStats.cache_size }}</span>
         </div>
       </div>
    </div>

         <!-- iframe Loading Progress -->
     <div *ngIf="iframeLoading && !videoReady" class="loading-progress">
       <div class="progress-container">
         <mat-progress-bar 
           mode="indeterminate" 
           class="progress-bar">
         </mat-progress-bar>
         <div class="progress-text">
           <span>Loading video player...</span>
         </div>
       </div>
     </div>

    <!-- Video Player -->
    <div *ngIf="videoReady" class="video-player-container">
      <div class="video-wrapper">
        <iframe 
          [src]="mediaUrl | safe" 
          class="video-iframe"
          frameborder="0"
          allowfullscreen
          allow="autoplay; encrypted-media; picture-in-picture"
          title="Video Preview"
          (load)="onIframeLoaded()">
          Your browser does not support iframes.
        </iframe>
        
        <!-- iframe Loading Indicator -->
        <div *ngIf="iframeLoading" class="iframe-loading">
          <div class="loading-spinner">
            <mat-spinner diameter="24"></mat-spinner>
          </div>
          <span class="loading-text">Loading video player...</span>
        </div>
      </div>
      
      
    </div>

    <!-- iframe Error State -->
    <div *ngIf="videoError" class="video-error">
      <div class="error-content">
        <mat-icon class="error-icon">video_library</mat-icon>
        <h3>Video Player Loading Failed</h3>
        <p>{{ errorMessage }}</p>
        <div class="error-actions">
          <button mat-raised-button color="primary" (click)="retry()">
            <mat-icon>refresh</mat-icon>
            Retry Loading
          </button>

          <button mat-raised-button color="accent" (click)="downloadFile()">
            <mat-icon>download</mat-icon>
            Download Video
          </button>
        </div>
      </div>
    </div>

         <!-- Action Buttons -->
     <div class="action-buttons">
       <button 
         mat-raised-button 
         color="primary" 
         (click)="downloadFile()"
         class="download-button">
         <mat-icon>download</mat-icon>
         Download File
       </button>
       

       
       <button 
         mat-raised-button 
         color="accent" 
         (click)="retry()"
         class="retry-button">
         <mat-icon>refresh</mat-icon>
         Reload Preview
       </button>
     </div>
  </div>
</div>
