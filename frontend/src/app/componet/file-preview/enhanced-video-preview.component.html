<!-- In file: Frontend/src/app/componet/file-preview/enhanced-video-preview.component.html -->

<div class="enhanced-video-preview">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-content">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="loading-text">Initializing video preview...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <div class="error-content">
      <mat-icon class="error-icon">error</mat-icon>
      <h3>Preview Error</h3>
      <p>{{ errorMessage }}</p>
             <div class="error-actions">
         <button mat-raised-button color="primary" (click)="retry()">
           <mat-icon>refresh</mat-icon>
           Retry
         </button>
         <button mat-raised-button color="warn" (click)="useFallbackPreview()">
           <mat-icon>video_library</mat-icon>
           Use Basic Preview
         </button>
         <button mat-raised-button color="accent" (click)="downloadFile()">
           <mat-icon>download</mat-icon>
           Download File
         </button>
       </div>
    </div>
  </div>

  <!-- Video Preview Content -->
  <div *ngIf="!loading && !error" class="video-content">
    <!-- File Information Header -->
    <div class="file-info-header">
      <div class="file-details">
        <h3>{{ previewMetadata?.filename }}</h3>
        <p class="file-meta">
          <span class="file-size">{{ getFormattedFileSize() }}</span>
          <span class="file-type">{{ previewMetadata?.content_type }}</span>
          <span class="connection-speed">{{ getConnectionSpeedText() }}</span>
        </p>
      </div>
      
             <!-- Cache Statistics -->
       <div *ngIf="cacheStats" class="cache-stats">
         <div class="cache-stat-item">
           <span class="cache-label">Cache Hit Rate:</span>
           <span class="cache-value">{{ cacheStats.hit_rate_percent }}%</span>
         </div>
         <div class="cache-stat-item">
           <span class="cache-label">Cached Items:</span>
           <span class="cache-value">{{ cacheStats.cache_size }}</span>
         </div>
       </div>
    </div>

         <!-- Simple Loading Progress -->
     <div *ngIf="videoLoading && !videoReady" class="loading-progress">
       <div class="progress-container">
         <mat-progress-bar 
           mode="indeterminate" 
           class="progress-bar">
         </mat-progress-bar>
         <div class="progress-text">
           <span>Loading video preview...</span>
         </div>
       </div>
     </div>

    <!-- Video Player -->
    <div *ngIf="videoReady" class="video-player-container">
      <div class="video-wrapper">
                 <video 
           #videoPlayer
           [src]="mediaUrl" 
           controls 
           preload="metadata"
           class="video-player"
           (loadedmetadata)="onVideoLoaded()"
           (canplay)="onVideoCanPlay()"
           (timeupdate)="onVideoTimeUpdate()"
           (error)="onVideoError($event)"
           (progress)="onVideoProgress()">
           Your browser does not support the video tag.
         </video>
        
                 <!-- Custom Video Controls Overlay -->
         <div class="custom-video-controls">
           <div class="control-group">
             <button 
               mat-mini-fab 
               color="primary" 
               class="skip-button skip-back"
               [disabled]="!isVideoReadyForSeeking()"
               (click)="skipBackward()"
               (mouseenter)="onButtonHover('back')"
               (mouseleave)="onButtonLeave()"
               title="Skip back 10 seconds">
               <mat-icon>{{ isSeeking ? 'hourglass_empty' : 'replay_10' }}</mat-icon>
             </button>
             <span class="control-label">-10s</span>
           </div>
           
           <div class="control-group">
             <button 
               mat-mini-fab 
               color="primary" 
               class="skip-button skip-forward"
               [disabled]="!isVideoReadyForSeeking()"
               (click)="skipForward()"
               (mouseenter)="onButtonHover('forward')"
               (mouseleave)="onButtonLeave()"
               title="Skip forward 10 seconds">
               <mat-icon>{{ isSeeking ? 'hourglass_empty' : 'forward_10' }}</mat-icon>
             </button>
             <span class="control-label">+10s</span>
           </div>
         </div>
         
         <!-- Seeking Indicator -->
         <div *ngIf="isSeeking" class="seeking-indicator">
           <div class="seeking-spinner">
             <mat-spinner diameter="24"></mat-spinner>
           </div>
           <span class="seeking-text">Seeking...</span>
         </div>
      </div>
      
             <!-- Video Information -->
       <div class="video-info">
         <div class="info-grid">
           <div class="info-item">
             <span class="info-label">Format:</span>
             <span class="info-value">{{ previewMetadata?.content_type }}</span>
           </div>
           <div class="info-item" *ngIf="mediaInfo?.duration">
             <span class="info-label">Duration:</span>
             <span class="info-value">{{ getFormattedDuration() }}</span>
           </div>
           <div class="info-item" *ngIf="videoReady">
             <span class="info-label">Current Time:</span>
             <span class="info-value">{{ getCurrentVideoTime() }}</span>
           </div>
           <div class="info-item" *ngIf="mediaInfo?.width && mediaInfo?.height">
             <span class="info-label">Resolution:</span>
             <span class="info-value">{{ getFormattedDimensions() }}</span>
           </div>
                      <div class="info-item" *ngIf="mediaInfo?.bitrate">
              <span class="info-label">Bitrate:</span>
              <span class="info-value">{{ mediaInfo?.bitrate }} kbps</span>
            </div>
         </div>
       </div>
    </div>

    <!-- Video Error State -->
    <div *ngIf="videoError" class="video-error">
      <div class="error-content">
        <mat-icon class="error-icon">video_library</mat-icon>
        <h3>Video Loading Failed</h3>
        <p>{{ errorMessage }}</p>
                 <div class="error-actions">
           <button mat-raised-button color="primary" (click)="retry()">
             <mat-icon>refresh</mat-icon>
             Retry Loading
           </button>
           <button mat-raised-button color="warn" (click)="useFallbackPreview()">
             <mat-icon>video_library</mat-icon>
             Use Basic Preview
           </button>
           <button mat-raised-button color="accent" (click)="downloadFile()">
             <mat-icon>download</mat-icon>
             Download Video
           </button>
         </div>
      </div>
    </div>

         <!-- Action Buttons -->
     <div class="action-buttons">
       <button 
         mat-raised-button 
         color="primary" 
         (click)="downloadFile()"
         class="download-button">
         <mat-icon>download</mat-icon>
         Download File
       </button>
       
       <button 
         mat-raised-button 
         color="warn" 
         (click)="useFallbackPreview()"
         class="fallback-button">
         <mat-icon>video_library</mat-icon>
         Basic Preview
       </button>
       
       <button 
         mat-raised-button 
         color="accent" 
         (click)="retry()"
         class="retry-button">
         <mat-icon>refresh</mat-icon>
         Reload Preview
       </button>
     </div>
  </div>
</div>
